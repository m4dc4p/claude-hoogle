# Hoogle Reference

Hoogle is a Haskell API search engine. This reference covers CLI usage and search syntax.

## Installation

```bash
cabal install hoogle
# or
stack install hoogle
```

## Commands

### Search

```bash
hoogle [search] [OPTIONS] [QUERY]
```

**Flags:**
- `--json` - Output results as JSON
- `--jsonl` - Output results as JSON Lines
- `-l, --link` - Include URLs for each result
- `--numbers` - Show counter for each result
- `-i, --info` - Extended information about first result
- `-d, --database=FILE` - Specify database file (.hoo extension)
- `-n, --count=INT` - Maximum results (default: 10)

**Examples:**
```bash
hoogle search map
hoogle search "a -> b -> a" --count 5
hoogle search "+base filter" --json
hoogle search foldl --info
```

### Generate

```bash
hoogle generate [OPTIONS] [PACKAGE]
```

**Flags:**
- `--download` - Download all files from the web
- `--database=FILE` - Output database file
- `--local[=ITEM]` - Index local packages
- `--haddock=ITEM` - Use local haddock docs
- `-n, --count=INT` - Maximum packages to index

**Examples:**
```bash
# Generate from Stackage (all packages)
hoogle generate

# Generate for specific packages only
hoogle generate base filepath

# Generate from local ghc-pkg installed packages
hoogle generate --local

# Generate from a directory of .txt files
hoogle generate --local=mydir
```

## Database

- Default location: `~/.hoogle/default-haskell-VERSION.hoo`
- Generated from `.txt` files (Hoogle input format)
- Can be generated by Cabal: `cabal haddock --haddock-hoogle`

## Search Syntax

### By Name

```bash
hoogle map
hoogle Data.Map.lookup
hoogle "Data.List"
```

### By Type Signature

```bash
hoogle "a -> b"
hoogle "(a -> b) -> [a] -> [b]"
hoogle "Monad m => m a -> (a -> m b) -> m b"
```

### Package Filters

```bash
hoogle "+base map"           # Search in base package
hoogle "+containers lookup"  # Search in containers
hoogle "+lens -base view"    # Include lens, exclude base
```

### Module Filters

```bash
hoogle "is:module Data.List"
hoogle "is:package base"
```

## JSON Output Format

```json
[
  {
    "url": "https://hackage.haskell.org/package/base/docs/Prelude.html#v:map",
    "module": {
      "url": "https://hackage.haskell.org/package/base/docs/Prelude.html",
      "name": "Prelude"
    },
    "package": {
      "url": "https://hackage.haskell.org/package/base",
      "name": "base"
    },
    "item": "map :: (a -> b) -> [a] -> [b]",
    "type": "",
    "docs": "map f xs is the list obtained by applying f to each element..."
  }
]
```

## Type Search Algorithm

Hoogle matches types by applying rewrites:
- **Arg reorder**: `x -> y -> z` matches `y -> x -> z`
- **Arg delete**: Can drop one argument from either side
- **Variable rename**: Type variables are unified
- **Alias follow**: Follows type synonyms (`FilePath -> String`)
- **Instance subtype**: Uses typeclass instances for matching

## Tips

1. **Type variables are flexible**: `a -> a` finds `id`, `Int -> Int` finds specific functions
2. **Use parentheses for complex types**: `(a -> b) -> [a] -> [b]`
3. **Package filters narrow results**: `+base` restricts to base package
4. **Quotes help with operators**: `hoogle ">>="` or `hoogle "bind"`
5. **Context is optional**: `m a -> m b` matches `Monad m => m a -> m b`

## Common Searches

| Goal | Query |
|------|-------|
| Find function by name | `map` |
| Find by exact type | `(a -> Bool) -> [a] -> [a]` |
| Find in package | `+lens view` |
| Find monadic bind | `Monad m => m a -> (a -> m b) -> m b` |
| Find by return type | `-> Maybe a` |
| Find class methods | `Functor f => (a -> b) -> f a -> f b` |
